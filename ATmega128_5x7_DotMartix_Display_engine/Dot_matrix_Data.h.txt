#include <Arduino.h>


uint8_t FontCharMap[128] = {
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,//
	0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,
	35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,
	67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,
 };
// 5x7 font data for all digits
 const byte FontChar_DotMatrix_5x7[][7] ={
    { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF }, // space
    { 0xFB, 0xFB, 0xFB, 0xFB, 0xFF, 0xFF, 0xFB },//!
    { 0xF5, 0xF5, 0xF5, 0xFF, 0xFF, 0xFF, 0xFF },//"
    { 0xF5, 0xF5, 0xE0, 0xF5, 0xE0, 0xF5, 0xF5 },//# 
    { 0xFB, 0xF0, 0xEB, 0xF1, 0xFA, 0xE1, 0xFB },//$
    { 0xE7, 0xE6, 0xFD, 0xFB, 0xF7, 0xEC, 0xFC },//%
    { 0xF3, 0xED, 0xEB, 0xF7, 0xEA, 0xED, 0xF2 },//&
    { 0xF3, 0xFB, 0xF7, 0xFF, 0xFF, 0xFF, 0xFF },//'
    { 0xFD, 0xFB, 0xF7, 0xF7, 0xF7, 0xFB, 0xFD },//(
    { 0xF7, 0xFB, 0xFD, 0xFD, 0xFD, 0xFB, 0xF7 },//)
    { 0xFF, 0xFB, 0xEA, 0xF1, 0xEA, 0xFB, 0xFF },//*
    { 0xFF, 0xFB, 0xFB, 0xE0, 0xFB, 0xFB, 0xFF },//+
    { 0xFF, 0xFF, 0xFF, 0xFF, 0xF3, 0xFB, 0xF7 },//,
    { 0xFF, 0xFF, 0xFF, 0xE0, 0xFF, 0xFF, 0xFF },//-
    { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF3, 0xF3 },//.
    { 0xFF, 0xFE, 0xFD, 0xFB, 0xF7, 0xEF, 0xFF },///
    {0xF1,0xEE,0xEC,0xEA,0xE6,0xEE,0xF1}, // 0
    {0xFB,0xF3,0xFB,0xFB,0xFB,0xFB,0xF1}, // 1
    {0xF1,0xEE,0xFE,0xFD,0xFB,0xF7,0xE0}, // 2
    {0xE0,0xFD,0xFB,0xFD,0xFE,0xEE,0xF1}, // 3
    {0xFD,0xF9,0xF5,0xED,0xE0,0xFD,0xFD}, // 4
    {0xE0,0xEF,0xE1,0xFE,0xFE,0xEE,0xF1}, // 5
    {0xF9,0xF7,0xEF,0xE1,0xEE,0xEE,0xF1}, // 6
    {0xE1,0xFE,0xFD,0xFB,0xF7,0xF7,0xF7}, // 7
    {0xF1,0xEE,0xEE,0xF1,0xEE,0xEE,0xF1}, // 8
    {0xF1,0xEE,0xEE,0xF0,0xFE,0xFD,0xF3},  // 9
    { 0xFF, 0xF3, 0xF3, 0xFF, 0xF3, 0xF3, 0xFF },//:
    { 0xFF, 0xF3, 0xF3, 0xFF, 0xF3, 0xFB, 0xF7 },//;
    { 0xFD, 0xFB, 0xF7, 0xEF, 0xF7, 0xFB, 0xFD },//<
    { 0xFF, 0xFF, 0xE0, 0xFF, 0xE0, 0xFF, 0xFF },//=
    { 0xF7, 0xFB, 0xFD, 0xFE, 0xFD, 0xFB, 0xF7 },//>
    { 0xF1, 0xFE, 0xFE, 0xF9, 0xFB, 0xFF, 0xFB },//?
    { 0xF1, 0xEE, 0xFE, 0xF2, 0xEA, 0xEA, 0xF1 },//@
    { 0xF1, 0xEE, 0xEE, 0xE0, 0xEE, 0xEE, 0xEE }, //A
    { 0xE1, 0xEE, 0xEE, 0xE1, 0xEE, 0xEE, 0xE1 },//B
    { 0xF1, 0xEE, 0xEF, 0xEF, 0xEF, 0xEE, 0xF1 }, //C
    { 0xE3, 0xED, 0xEE, 0xEE, 0xEE, 0xED, 0xE3 }, //D
    { 0xE0, 0xEF, 0xEF, 0xE1, 0xEF, 0xEF, 0xE0 }, //E
    { 0xE0, 0xEF, 0xEF, 0xE1, 0xEF, 0xEF, 0xEF }, //F
    { 0xF1, 0xEE, 0xEF, 0xE8, 0xEE, 0xEE, 0xF0 }, //G
    { 0xEE, 0xEE, 0xEE, 0xE0, 0xEE, 0xEE, 0xEE }, //H
    { 0xF1, 0xFB, 0xFB, 0xFB, 0xFB, 0xFB, 0xF1 }, //I
    { 0xF8, 0xFD, 0xFD, 0xFD, 0xFD, 0xED, 0xF3 }, //J
    { 0xEE, 0xED, 0xEB, 0xE7, 0xEB, 0xED, 0xEE }, //K
    { 0xEF, 0xEF, 0xEF, 0xEF, 0xEF, 0xEF, 0xE0 }, //L
    { 0xEE, 0xE4, 0xEA, 0xEA, 0xEE, 0xEE, 0xEE }, //M
    { 0xEE, 0xEE, 0xE6, 0xEA, 0xEC, 0xEE, 0xEE }, //N
    { 0xF1, 0xEE, 0xEE, 0xEE, 0xEE, 0xEE, 0xF1 }, //O
    { 0xE1, 0xEE, 0xEE, 0xE1, 0xEF, 0xEF, 0xEF }, //P
    { 0xF1, 0xEE, 0xEE, 0xEE, 0xEA, 0xEC, 0xF2 }, //Q
    { 0xE1, 0xEE, 0xEE, 0xE1, 0xEB, 0xED, 0xEE }, //R
    { 0xF0, 0xEF, 0xEF, 0xF1, 0xFE, 0xFE, 0xE1 }, //S
    { 0xE0, 0xFB, 0xFB, 0xFB, 0xFB, 0xFB, 0xFB }, //T
    { 0xEE, 0xEE, 0xEE, 0xEE, 0xEE, 0xEE, 0xF1 }, //U
    { 0xEE, 0xEE, 0xEE, 0xEE, 0xEE, 0xF5, 0xFB }, //V
    { 0xEE, 0xEE, 0xEE, 0xEA, 0xEA, 0xEA, 0xF5 }, //W
    { 0xEE, 0xEE, 0xF5, 0xFB, 0xF5, 0xEE, 0xEE }, //X
    { 0xEE, 0xEE, 0xEE, 0xF5, 0xFB, 0xFB, 0xFB }, //Y
    { 0xE0, 0xFE, 0xFD, 0xFB, 0xF7, 0xEF, 0xE0 }, //Z
    { 0xFF, 0xFF, 0xF1, 0xFE, 0xF0, 0xEE, 0xF0 },//a
    { 0xEF, 0xEF, 0xEF, 0xE1, 0xEE, 0xEE, 0xE1 },//b
    { 0xFF, 0xFF, 0xF0, 0xEF, 0xEF, 0xEF, 0xF0 },//c
    { 0xFE, 0xFE, 0xFE, 0xF0, 0xEE, 0xEE, 0xF0 },//d
    { 0xFF, 0xFF, 0xF1, 0xEE, 0xE0, 0xEF, 0xF0 },//e
    { 0xFD, 0xFA, 0xFB, 0xF1, 0xFB, 0xFB, 0xFB },//f
    { 0xFF, 0xFF, 0xF0, 0xEE, 0xF0, 0xFE, 0xE1 },//g
    { 0xEF, 0xEF, 0xEF, 0xE1, 0xEE, 0xEE, 0xEE },//h
    { 0xFF, 0xFB, 0xFF, 0xFB, 0xFB, 0xFB, 0xFB },//i
    { 0xFD, 0xFF, 0xFD, 0xFD, 0xFD, 0xED, 0xF3 },//j
    { 0xF7, 0xF7, 0xF6, 0xF5, 0xF3, 0xF5, 0xF6 },//k
    { 0xF3, 0xFB, 0xFB, 0xFB, 0xFB, 0xFB, 0xF1 },//l
    { 0xFF, 0xFF, 0xE4, 0xEA, 0xEA, 0xEE, 0xEE },//m
    { 0xFF, 0xFF, 0xE9, 0xE6, 0xEE, 0xEE, 0xEE },//n
    { 0xFF, 0xFF, 0xF1, 0xEE, 0xEE, 0xF1, 0xFF },//o
    { 0xFF, 0xFF, 0xE1, 0xEE, 0xE1, 0xEF, 0xEF },//p
    { 0xFF, 0xFF, 0xF0, 0xEE, 0xF0, 0xFE, 0xFE },//q
    { 0xFF, 0xFF, 0xE9, 0xE6, 0xEF, 0xEF, 0xEF },//r
    { 0xFF, 0xFF, 0xF0, 0xEF, 0xF1, 0xFE, 0xE1 },//s
    { 0xFB, 0xFB, 0xE0, 0xFB, 0xFB, 0xFA, 0xFD },//t
    { 0xFF, 0xFF, 0xEE, 0xEE, 0xEE, 0xEE, 0xF1 },//u
    { 0xFF, 0xFF, 0xEE, 0xEE, 0xEE, 0xF5, 0xFB },//v
    { 0xFF, 0xFF, 0xEE, 0xEE, 0xEA, 0xEA, 0xF5 },//w
    { 0xFF, 0xFF, 0xEE, 0xF5, 0xFB, 0xF5, 0xEE },//x
    { 0xFF, 0xFF, 0xEE, 0xF5, 0xFB, 0xFB, 0xF7 },//y
    { 0xFF, 0xFF, 0xE0, 0xFD, 0xFB, 0xF7, 0xE0 } //z

 };

static inline uint8_t remap_Font_to_U3(uint8_t original)
{
    uint8_t u3 = 0xFF;   // all OFF (active-low)

    // C1
    if (!(original & (1 << 4))) u3 &= ~(1 << 6);

    // C2
    if (!(original & (1 << 3))) u3 &= ~(1 << 5);

    // C3
    if (!(original & (1 << 2))) u3 &= ~(1 << 4);

    // C4
    if (!(original & (1 << 1))) u3 &= ~(1 << 3);

    // C5
    if (!(original & (1 << 0))) u3 &= ~(1 << 2);




    return u3;
}

static inline void remap_font_to_U3_u1(uint8_t original, uint8_t* u3, uint8_t* u1) {
    *u3 = 0xFF;   // all OFF (active-low)
    *u1 = 0xFF;   // all OFF (active-low)

    // C1 → U3 bit1
    if (!(original & (1 << 4))) *u3 &= ~(1 << 1);

    // C2 → U3 bit0
    if (!(original & (1 << 3))) *u3 &= ~(1 << 0);

    // C3 → U3 bit7
    if (!(original & (1 << 2))) *u3 &= ~(1 << 7);

    // C4 → U1 bit6
    if (!(original & (1 << 1))) *u1 &= ~(1 << 6);

    // C5 → U1 bit5
    if (!(original & (1 << 0))) *u1 &= ~(1 << 5);
}